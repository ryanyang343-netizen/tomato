<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简番茄时钟</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #f87070; /* 专注红 */
            --secondary-color: #1e213f; /* 深色背景 */
            --surface-color: #161932; /* 卡片背景 */
            --text-color: #d7e0ff;
            --font-family: 'Poppins', sans-serif;
            
            --circle-bg: #161932;
            --shadow-light: rgba(255, 255, 255, 0.05);
            --shadow-dark: rgba(0, 0, 0, 0.5);
        }

        /* 模式颜色变量 */
        body.pomodoro { --current-color: #f87070; }
        body.short-break { --current-color: #70f3f8; }
        body.long-break { --current-color: #d881f8; }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.4s ease;
        }

        body {
            background-color: var(--secondary-color);
            color: var(--text-color);
            font-family: var(--font-family);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* 标题 */
        h1 {
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: var(--text-color);
        }

        /* 模式切换栏 */
        .mode-container {
            background-color: var(--surface-color);
            padding: 8px;
            border-radius: 50px;
            display: flex;
            margin-bottom: 40px;
            z-index: 10;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .mode-btn {
            background: none;
            border: none;
            color: rgba(215, 224, 255, 0.4);
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .mode-btn.active {
            background-color: var(--current-color);
            color: var(--secondary-color);
        }

        /* 计时器圆环容器 */
        .timer-container {
            position: relative;
            width: 320px;
            height: 320px;
            background: linear-gradient(135deg, var(--surface-color), #1e2140);
            border-radius: 50%;
            box-shadow: 
                -20px -20px 60px var(--shadow-light), 
                20px 20px 60px var(--shadow-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
            cursor: pointer;
        }

        /* SVG 进度条 */
        .progress-ring {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring__circle {
            transition: stroke-dashoffset 0.1s linear, stroke 0.4s ease;
            transform-origin: 50% 50%;
            stroke: var(--current-color);
        }

        /* 时间文字 */
        .timer-display {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        .time {
            font-size: 5rem;
            font-weight: 600;
            line-height: 1;
            user-select: none;
        }

        .status-text {
            margin-top: 15px;
            letter-spacing: 10px;
            text-transform: uppercase;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .status-text:hover {
            color: var(--current-color);
        }

        /* 设置按钮 */
        .settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: rgba(215, 224, 255, 0.6);
            font-size: 1.5rem;
            cursor: pointer;
        }
        .settings-btn:hover { color: var(--text-color); }

        /* 任务列表区域 */
        .tasks-section {
            width: 100%;
            max-width: 400px;
            margin-top: 20px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .task-input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 10px;
            border: none;
            background-color: var(--surface-color);
            color: var(--text-color);
            font-family: inherit;
        }

        .add-btn {
            padding: 0 20px;
            border-radius: 10px;
            border: none;
            background-color: var(--current-color);
            color: var(--secondary-color);
            font-weight: bold;
            cursor: pointer;
        }

        .task-list {
            list-style: none;
        }

        .task-item {
            background-color: var(--surface-color);
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid transparent;
        }

        .task-item.active-task {
            border-left: 5px solid var(--current-color);
        }

        .task-item.completed {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .delete-task {
            background: none;
            border: none;
            color: #ff5e5e;
            cursor: pointer;
            font-size: 1.2rem;
            margin-left: 10px;
        }

        /* 模态框 (设置) */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        .modal.open { display: flex; }
        
        .modal-content {
            background: #fff;
            color: var(--secondary-color);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 350px;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: bold;
        }
        .setting-row {
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .setting-row input {
            width: 70px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f4f4f4;
        }
        .apply-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            margin-top: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        @media (max-width: 450px) {
            .timer-container { width: 260px; height: 260px; }
            .time { font-size: 4rem; }
        }
    </style>
</head>
<body class="pomodoro">

    <!-- 设置按钮 -->
    <button class="settings-btn" onclick="toggleSettings()">⚙️</button>

    <h1>番茄时钟</h1>

    <!-- 模式切换 -->
    <div class="mode-container">
        <button class="mode-btn active" data-mode="pomodoro">专注</button>
        <button class="mode-btn" data-mode="short-break">短休息</button>
        <button class="mode-btn" data-mode="long-break">长休息</button>
    </div>

    <!-- 计时器圆盘 -->
    <div class="timer-container" id="timer-btn">
        <svg class="progress-ring" width="320" height="320">
            <circle 
                class="progress-ring__circle"
                stroke="white"
                stroke-width="12"
                fill="transparent"
                r="135"
                cx="160"
                cy="160"
                stroke-linecap="round"
            />
        </svg>
        <div class="timer-display">
            <div class="time" id="time">25:00</div>
            <div class="status-text" id="action-text">START</div>
        </div>
    </div>

    <!-- 任务列表 -->
    <div class="tasks-section">
        <div class="input-group">
            <input type="text" class="task-input" id="taskInput" placeholder="添加待办事项...">
            <button class="add-btn" onclick="addTask()">+</button>
        </div>
        <ul class="task-list" id="taskList">
            <!-- 任务将在这里生成 -->
        </ul>
    </div>

    <!-- 设置弹窗 -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>设置</span>
                <span onclick="toggleSettings()" style="cursor:pointer">&times;</span>
            </div>
            <div class="setting-row">
                <label>专注 (分钟)</label>
                <input type="number" id="pomodoroTime" value="25">
            </div>
            <div class="setting-row">
                <label>短休息 (分钟)</label>
                <input type="number" id="shortTime" value="5">
            </div>
            <div class="setting-row">
                <label>长休息 (分钟)</label>
                <input type="number" id="longTime" value="15">
            </div>
            <button class="apply-btn" onclick="applySettings()">应用设置</button>
        </div>
    </div>

    <script>
        // 1. 变量与配置
        const circle = document.querySelector('.progress-ring__circle');
        const radius = circle.r.baseVal.value;
        const circumference = radius * 2 * Math.PI;
        
        // 设置SVG圆环
        circle.style.strokeDasharray = `${circumference} ${circumference}`;
        circle.style.strokeDashoffset = circumference;

        let timers = {
            pomodoro: 25,
            'short-break': 5,
            'long-break': 15
        };

        let currentMode = 'pomodoro';
        let timeLeft = timers[currentMode] * 60;
        let timerInterval = null;
        let isRunning = false;
        
        // DOM 元素
        const timeDisplay = document.getElementById('time');
        const actionText = document.getElementById('action-text');
        const modeButtons = document.querySelectorAll('.mode-btn');
        const timerBtn = document.getElementById('timer-btn');
        
        // 音频上下文 (用于生成提示音)
        let audioCtx;

        // 2. 核心计时器逻辑
        function setProgress(percent) {
            const offset = circumference - (percent / 100) * circumference;
            circle.style.strokeDashoffset = offset;
        }

        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const displayString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            timeDisplay.textContent = displayString;
            document.title = `${displayString} - 番茄时钟`;

            // 计算进度百分比 (用于圆环)
            const totalTime = timers[currentMode] * 60;
            const progressPercent = ((totalTime - timeLeft) / totalTime) * 100;
            setProgress(progressPercent);
        }

        function toggleTimer() {
            if (isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            if (isRunning) return;
            
            // 初始化音频上下文（解决浏览器自动播放策略）
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            isRunning = true;
            actionText.textContent = "PAUSE";
            
            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateDisplay();
                } else {
                    completeTimer();
                }
            }, 1000);
        }

        function pauseTimer() {
            isRunning = false;
            actionText.textContent = "RESUME";
            clearInterval(timerInterval);
        }

        function resetTimer() {
            pauseTimer();
            timeLeft = timers[currentMode] * 60;
            actionText.textContent = "START";
            setProgress(0); // 重置圆环
            updateDisplay();
        }

        function completeTimer() {
            pauseTimer();
            actionText.textContent = "DONE";
            playBeep(); // 播放提示音
            // 这里可以添加自动切换模式的逻辑
            setTimeout(() => {
                alert("计时结束！");
                resetTimer();
            }, 500);
        }

        // 3. 模式切换
        modeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const mode = btn.dataset.mode;
                switchMode(mode);
            });
        });

        function switchMode(mode) {
            currentMode = mode;
            
            // 更新按钮状态
            modeButtons.forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

            // 更新 Body 类名以切换主题色
            document.body.className = mode;

            resetTimer();
        }

        // 4. 事件监听
        timerBtn.addEventListener('click', toggleTimer);

        // 5. 设置相关
        const modal = document.getElementById('settingsModal');
        function toggleSettings() {
            modal.classList.toggle('open');
            // 关闭时如果是打开状态，填充当前设置值
            if(modal.classList.contains('open')){
                document.getElementById('pomodoroTime').value = timers.pomodoro;
                document.getElementById('shortTime').value = timers['short-break'];
                document.getElementById('longTime').value = timers['long-break'];
            }
        }

        function applySettings() {
            const pTime = parseInt(document.getElementById('pomodoroTime').value);
            const sTime = parseInt(document.getElementById('shortTime').value);
            const lTime = parseInt(document.getElementById('longTime').value);

            if(pTime > 0 && sTime > 0 && lTime > 0) {
                timers.pomodoro = pTime;
                timers['short-break'] = sTime;
                timers['long-break'] = lTime;
                
                resetTimer();
                toggleSettings();
            } else {
                alert("请输入有效的时间！");
            }
        }

        // 6. 任务列表 (To-Do List)
        const taskInput = document.getElementById('taskInput');
        const taskList = document.getElementById('taskList');

        function addTask() {
            const text = taskInput.value.trim();
            if (text === "") return;

            const li = document.createElement('li');
            li.className = 'task-item';
            li.innerHTML = `
                <span onclick="toggleTask(this)">${text}</span>
                <button class="delete-task" onclick="deleteTask(this)">×</button>
            `;
            
            // 点击任务文字将其设为“当前激活任务”
            li.addEventListener('click', (e) => {
                if(e.target.tagName !== 'BUTTON') {
                   document.querySelectorAll('.task-item').forEach(i => i.classList.remove('active-task'));
                   li.classList.add('active-task');
                }
            });

            taskList.appendChild(li);
            taskInput.value = "";
        }

        // 允许回车添加任务
        taskInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') addTask();
        });

        window.toggleTask = function(span) {
            span.parentElement.classList.toggle('completed');
        }

        window.deleteTask = function(btn) {
            btn.parentElement.remove();
        }

        // 7. 音频合成 (Beep Sound)
        function playBeep() {
            if (!audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.type = 'sine';
            oscillator.frequency.value = 800; // 频率 Hz
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); // 音量
            
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5); // 播放0.5秒
            
            // 连续响两声
            setTimeout(() => {
                const osc2 = audioCtx.createOscillator();
                const gain2 = audioCtx.createGain();
                osc2.connect(gain2);
                gain2.connect(audioCtx.destination);
                osc2.frequency.value = 800;
                gain2.gain.setValueAtTime(0.1, audioCtx.currentTime);
                osc2.start();
                osc2.stop(audioCtx.currentTime + 0.5);
            }, 600);
        }

        // 初始化显示
        updateDisplay();
        // 响应式SVG调整 (简易版)
        window.addEventListener('resize', () => {
             // 可以在这里添加重绘 SVG 的逻辑，如果需要更复杂的响应式
        });

    </script>
</body>
</html>